<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>编辑修改红包</title>

    <link rel="stylesheet" type="text/css" href="../../static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/Hui-iconfont/1.0.8/iconfont.css" />

	<style>
		input:-webkit-autofill,input:-webkit-autofill:hover,
		input:-webkit-autofill:focus {box-shadow:0 0 0 60px #fff inset;-webkit-text-fill-color: #666;}
		input::-webkit-outer-spin-button,
    	input::-webkit-inner-spin-button {-webkit-appearance: none;}
    	input[type="number"]{-moz-appearance: textfield;}
		.red {color: red;}
		.select-box.inline{width: 40%;}
		.select-box.inline select {width: 100% !important;}
		.form .row{margin-left: 0 !important;margin-right: 0 !important;}
		.subWrap{padding:20px 0px;text-align: center;}
		.spu-cont .inputText {width: 40%; display: inline-block;}
		.spu-cont .inputText input{width: 100%;}
		.continueAdd {margin-right: 20px;}
		.typeShow{display: none;}


	</style>
</head>

<body>
    <div class="article">
        <article class="cl pd-20">
            
            <div class="spu-cont">
                <div id="form-step-1" class="form form-horizontal form-step active" action="#" method="post">
                	
                	<div class="row cl">
                        <label class="form-label col-xs-2 col-sm-2">
                            <span class="red"></span>选择活动：</label>
                        <div class="formControls col-xs-10 col-sm-10">
                            <span class="select-box inline">
                                <select id="activitys" class="select" name="activitys">
                                	
                                </select>
                            </span>
                        </div>
                    </div>
                    
                    <div class="row cl">
                        <label class="form-label col-xs-2 col-sm-2">
                            <span class="red"></span>红包类型：</label>
                        <div class="formControls col-xs-10 col-sm-10">
                            <span class="select-box inline">
                                <select id="type" class="select" name="type">
                                    <option value="" >请选择红包类型</option>
                                    <option value="1" >现金红包</option>
                                    <option value="2" >满减红包</option>
                                </select>
                            </span>
                        </div>
                    </div>
                    
                    <div class="row cl typeShow" >
                        <label class="form-label col-xs-2 col-sm-2">
                            <span class="red"></span>使用条件：</label>
                        <div class="formControls col-xs-10 col-sm-10">
                        	<div class="inputText">
	                            <input id="condition" class="input-text" placeholder="请输入使用条件" type="number" name="condition">
	                            <span class="s-mark"></span>
                            </div>
                            <span>元</span>
                            <div class="check-box">
                                <label for="selected">满**元可使用</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row cl">
                        <label class="form-label col-xs-2 col-sm-2">
                            <span class="red"></span>红包金额：</label>
                        <div class="formControls col-xs-10 col-sm-10">
                        	<div class="inputText">
	                            <input id="amount" class="input-text" placeholder="请输入红包金额" type="number" name="amount">
	                            <span class="s-mark"></span>
                            </div>
                            <span>元</span>
                        </div>
                    </div>
                    
                    <div class="row cl">
                        <label class="form-label col-xs-2 col-sm-2">
                            <span class="red"></span>红包数量：</label>
                        <div class="formControls col-xs-10 col-sm-10">
                        	<div class="inputText">
                        		<input id="numberType" class="input-text" type="hidden" >
	                            <input id="number" class="input-text" placeholder="请输入红包数量" type="number" name="number">
	                            <span class="s-mark"></span>
                            </div>
                            <span>个</span>
                            <div class="check-box">
                                <input type="checkbox" id="selected" name="selected" >
                                <label for="selected">不限</label>
                            </div>
                        </div>
                    </div>

					<div class="row cl subWrap">
                        <div class="subWrap">
                            <span class="btn btn-primary submitBtn" onclick="">确定</span>
                        </div>
                    </div>
                    
                </div>
                
        </article>
    </div>

    <!--footer 作为公共模版分离出去-->
    <script type="text/javascript" src="../../lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="../../static/h-ui/js/H-ui.min.js"></script>
    <script type="text/javascript" src="../../static/h-ui.admin/js/H-ui.admin.js"></script>
    <!--footer 作为公共模版分离出去-->

    <script type="text/javascript" src="../../lib/laypage/1.2/laypage.js"></script>
    <script type="text/javascript" src="../../js/base/public.js?rev=@@hash"></script>
    <script type="text/javascript" src="../../js/common/common.js?rev=@@hash"></script>
    <script type="text/javascript" src="../../lib/My97DatePicker/4.8/WdatePicker.js"></script>
    <script type="text/javascript" src="../../lib/ueditor/1.4.3/ueditor.config.js"></script>
    <script type="text/javascript" src="../../lib/ueditor/1.4.3/ueditor.all.min.js"></script>
    <script type="text/javascript" src="../../lib/lrz.bundle.js"></script>
	<script type="text/javascript">
		var spuUtils = {
				isTrue:true,//提交开关
				shopData:{
					id:"",//路由带过来的id
					activity:"",
					type:"",
					amount:"",
					condition:"",
					number:"",
					
				},
				provinceList: [],
				//初始化
				init: function() {
					var path = location.href;
					
					// 获取路由参数
					if (path.indexOf('?') >= 0) {
		                var params = path.substring(path.indexOf('?') + 1, path.length).split('&'),
		                    id = '';
		                for (var i = 0; i < params.length; i++) {
		                    if (params[i].indexOf("id") != -1) {
		                        id = params[i].split("=")[1];
		                    }
		                }
		                if (id) {
		                	spuUtils.shopData.id = id;
		                    spuUtils.getDatas(id, true,callBack);
		                }
		            }
					
					//回调
					function callBack(){
						// 城市选择弹窗初始化
						$.get(base + 'redpacket/activityList', {}, function (res) {
					        if (res.status == '0' && res.data) {
					            var html = ' <option value="">请选择活动</option>';
						        spuUtils.provinceList = res.data;
						        $.each(res.data, function (index, item) {
						        	html += '<option value="' + item.activityId + '">' + item.name + '</option>'
						        });
						        $('#activitys').html(html);
						        //展示活动
								$("#activitys").val(spuUtils.shopData.activity);
					        }else {
					            $.Huimodalalert(res.message, 2000);
					        }
					    })
						
						
		               	
						
					}
					
				},
				
				//获取数据
				getDatas:function(id,bool,callback){
					$.get(base + 'redpacket/packetGetById', {id:id}, function (res) {
			            if (res.status == '0' && res.data) {
			            	spuUtils.shopData.activity = res.data.activityId;
			            	$("#type").val(res.data.type);
			            	$("#type").trigger("change");
			               	$("#amount").val(res.data.amount);
			               	if(res.data.condition  !="" && res.data.condition != undefined ){
			               		$("#condition").val(res.data.condition);
			               	}
			               	if(res.data.number !="" && res.data.number != undefined){
			               		$("#number").val(res.data.number);
			               	}
			               	if(res.data.numberType ==2){
			               		$("#selected").attr("checked", true);
			               	}
			            	callback()	
			            } else {
			                $.Huimodalalert(res.message, 2000);
			            }
			        })
				},	
		};
		
		//jq
		$(function(){
			//初始化
			spuUtils.init();
			
			//监听显示条件
			$("#type").on("change",function(){
				if($(this).children('option:selected').val() != "2"){
					$(".typeShow").hide();
				}else{
					$(".typeShow").show();
				}
			})
			
			//提交
			$(".spu-cont .submitBtn").on("click", function() {
				
				var data = {};
				// 必填项非空判断
				if($("#activitys option:selected").val() == "") {
					$.Huimodalalert("请选择活动", 1500);
					return false;
				}
				// 必填项非空判断
				if($("#type option:selected").val() == "") {
					$.Huimodalalert("请选择红包类型", 1500);
					return false;
				}
				
				if($("#type option:selected").val() == "2"){
					if($("#condition").val() == ""){
						$.Huimodalalert("请输入使用条件", 1500);
						return false;
					}else{
						data.condition = Number($("#condition").val());
					}
				}
				// 必填项非空判断
				if($("#amount").val() == "") {
					$.Huimodalalert("请输入红包金额", 1500);
					return false;
				}
				if($("#selected").is(":checked")){
                	data.numberType = 2;
                }else{
                	if($("#number").val() == ""){
                		$.Huimodalalert("请输入红包数量", 1500);
						return false;
                	}else{
                		data.number =Number($("#number").val());
                		data.numberType = 1;
                	}
                }
				data.activityId = Number($("#activitys option:selected").val());
				data.type = Number($("#type option:selected").val());
				data.amount = Number($("#amount").val());
				data.id = Number(spuUtils.shopData.id);
				
				if(spuUtils.isTrue){//防止重复提交
			        spuUtils.isTrue = false;
					$.ajax({
						type: "POST",
						url: base + "redpacket/packetEdit",
						data: JSON.stringify(data),
						contentType: "application/json;charset=utf-8",
						success: function(res) {
							if(res.status == "0") {
								$.Huimodalalert(res.message, 2000);
								setTimeout(function(){
									var index = parent.layer.getFrameIndex(window.name);
									//刷新列表
									window.parent.location.href = window.parent.location.href;
									parent.layer.close(index);
								},1000)
							} else {
								$.Huimodalalert(res.message, 1500);
							}
						},
						complete: function() {
							spuUtils.isTrue = true;
							layer.closeAll("loading");
						}
					});
				}
				
				
			})


		})
		
		
	</script>
</body>

</html>